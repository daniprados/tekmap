// TekMap by comunicatek.com  under the mit license.
// Author:  Dani Prados
// http://code.comunicatek.com
// version 0.6
(function(b){function j(a,c){b.browser.msie&&!h?b(window).bind("load",function(){l(a,c)}):l(a,c)}function l(a,c){var d,f,g,e={position:new google.maps.LatLng(a.lat,a.lng),map:c,draggable:a.draggable};a.icon&&(typeof a.icon==="object"?(f=new google.maps.Size(a.icon.size[0],a.icon.size[0]),d=a.icon.base?new google.maps.Point(a.icon.base[0],a.icon.base[1]):new google.maps.Point(0,0),g=new google.maps.Point(a.icon.origin[0],a.icon.origin[1]),d=new google.maps.MarkerImage(a.icon.url,f,d,g),b.extend(e,
e,{icon:d})):b.extend(e,e,{icon:a.icon}));a.shadow&&(typeof a.shadow==="object"?(f=new google.maps.Size(a.shadow.size[0],a.shadow.size[0]),d=a.shadow.base?new google.maps.Point(a.shadow.base[0],a.shadow.base[1]):new google.maps.Point(0,0),g=new google.maps.Point(a.shadow.origin[0],a.shadow.origin[1]),d=new google.maps.MarkerImage(a.shadow.url,f,d,g),b.extend(e,e,{shadow:d})):b.extend(e,e,{shadow:a.shadow}));var i=new google.maps.Marker(e);a.key&&(b.extend(i,{tekkey:a.key}),b.fn.TekMap.markersAssoc[a.key]=
i);b.fn.TekMap.markers.push(i);if(a.infowindow){var h=new google.maps.InfoWindow({content:a.infowindow});google.maps.event.addListener(i,"click",function(){h.open(c,i);a.infowindowclosePrevious&&(k&&k!==h&&k.close(),k=h)})}var j=a.drag||b.noop;a.draggable&&google.maps.event.addListener(i,"dragend",function(){j(i)})}function m(){function a(){for(var a=0;a<c.markers.length;a++)j(c.markers[a],g)}var c=b.fn.TekMap.opts,d=c.mapoptions,f=new google.maps.LatLng(c.lat,c.lng);d.center=f;var g=new google.maps.Map(this,
d);c.click&&google.maps.event.addListener(g,"click",c.click);d=b(this);b.browser.msie&&!h?b(window).load(a):a();d.data("tekmap",g)}var k=null,h=!1;b(window).bind("load",function(){h=!0});b.fn.TekMap=function(a){window.console&&window.console.log&&window.console.log("tekmap initialized");b.fn.TekMap.opts=b.extend({},b.fn.TekMap.defaults,a);b.fn.TekMap.markers=[];b.fn.TekMap.markersAssoc={};return this.each(m)};b.fn.TekMarker=function(a){b.fn.TekMap.p=b.extend({},b.fn.TekMarker.defaults,a);if(a.addres){var c=
this;(new google.maps.Geocoder).geocode({address:a.addres},function(a,f){f==google.maps.GeocoderStatus.OK&&b.each(a,function(a,d){b.fn.TekMap.p.lat=d.geometry.location.lat();b.fn.TekMap.p.lng=d.geometry.location.lng();c.each(b.fn.TekMarker.marker)})});return this}else return this.each(b.fn.TekMarker.marker)};b.fn.TekMarker.marker=function(){var a=b.fn.TekMap.p,c=b.fn.TekMap.map;c||(c=b(this).data("tekmap"));j(a,c)};b.fn.TekMarker.trigger=function(a,c,d){b.fn.TekMap.markersAssoc[a]&&(google.maps.event.trigger(b.fn.TekMap.markersAssoc[a],
c),typeof d==="function"&&d(b.fn.TekMap.markersAssoc[a]))};b.fn.TekMarker.remove=function(a){b.fn.TekMap.markersAssoc[a]&&(b.fn.TekMap.markersAssoc[a].setMap(null),delete b.fn.TekMap.markersAssoc[a])};b.fn.TekMap.markers=[];b.fn.TekMap.defaults={lat:42,lng:3,click:jQuery.noop,mapoptions:{zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1},markers:[]};b.fn.TekMarker.defaults={draggable:!1,infowindowclosePrevious:!0}})(jQuery);