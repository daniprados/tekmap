// TekMap by comunicatek.com  under the mit license.
// Author:  Dani Prados
// http://code.comunicatek.com
// version 0.9
(function(b,c,m){function q(a,h){var e=new c.maps.LatLng(a.lat,a.lng),f,d,k,g={position:e,map:h,draggable:a.draggable},l,n,m;a.options&&b.extend(g,g,a.options);a.icon&&("object"===typeof a.icon?(d=new c.maps.Size(a.icon.size[0],a.icon.size[0]),f=a.icon.base?new c.maps.Point(a.icon.base[0],a.icon.base[1]):new c.maps.Point(0,0),k=new c.maps.Point(a.icon.origin[0],a.icon.origin[1]),f=new c.maps.MarkerImage(a.icon.url,d,f,k),b.extend(g,g,{icon:f})):b.extend(g,g,{icon:a.icon}));a.shadow&&("object"===typeof a.shadow?
(d=new c.maps.Size(a.shadow.size[0],a.shadow.size[0]),f=a.shadow.base?new c.maps.Point(a.shadow.base[0],a.shadow.base[1]):new c.maps.Point(0,0),k=new c.maps.Point(a.shadow.origin[0],a.shadow.origin[1]),f=new c.maps.MarkerImage(a.shadow.url,d,f,k),b.extend(g,g,{shadow:f})):b.extend(g,g,{shadow:a.shadow}));l=new c.maps.Marker(g);a.key&&(b.extend(l,{tekkey:a.key}),b.fn.TekMap.markersAssoc[a.key]=l);b.fn.TekMap.markers.push(l);a.infowindow&&(n=new c.maps.InfoWindow({content:a.infowindow}),c.maps.event.addListener(l,
"click",function(){n.open(h,l);a.infowindowclosePrevious&&(p&&p!==n&&p.close(),p=n)}));m=a.drag||b.noop;a.draggable&&c.maps.event.addListener(l,"dragend",function(){m(l)});a.deferred&&a.deferred.resolve(e);b.fn.TekMap.bound.extend(e)}function r(a,h){var e=b.fn.TekMap.opts,f=e.mapoptions,d,k=b(h);if(d=k.data("lat"))e.lat=d;if(d=k.data("lng"))e.lng=d;if(d=k.data("markers"))e.markers=d;d=new c.maps.LatLng(e.lat,e.lng);f.center=d;f=new c.maps.Map(h,f);e.click&&c.maps.event.addListener(f,"click",e.click);
for(d=0;d<e.markers.length;d+=1)q(e.markers[d],f);k.data("tekmap",f)}var p=null;b.fn.TekMap=function(a){m.console&&m.console.log&&m.console.log("tekmap initialized"+this);b.fn.TekMap.opts=b.extend({},b.fn.TekMap.defaults,a);b.fn.TekMap.markers=[];b.fn.TekMap.markersAssoc={};b.fn.TekMap.bound=new c.maps.LatLngBounds;return this.each(r)};b.fn.TekfitBounds=function(){this.each(function(){b(this).data("tekmap").fitBounds(b.fn.TekMap.bound)})};b.fn.TekMarker=function(a){var h,e=this;b.fn.TekMap.p=b.extend({},
b.fn.TekMarker.defaults,a);return a.addres?(h=new c.maps.Geocoder,h.geocode({address:a.addres},function(f,d){d===c.maps.GeocoderStatus.OK?b.each(f,function(a,c){b.fn.TekMap.p.lat=c.geometry.location.lat();b.fn.TekMap.p.lng=c.geometry.location.lng();e.each(b.fn.TekMarker.marker)}):a.deferred.reject()}),this):this.each(b.fn.TekMarker.marker)};b.fn.TekMarker.marker=function(){var a=b.fn.TekMap.p,c=b.fn.TekMap.map;c||(c=b(this).data("tekmap"));q(a,c)};b.fn.TekMarker.trigger=function(a,h,e){b.fn.TekMap.markersAssoc[a]&&
(c.maps.event.trigger(b.fn.TekMap.markersAssoc[a],h),"function"===typeof e&&e(b.fn.TekMap.markersAssoc[a]))};b.fn.TekMarker.remove=function(a){b.fn.TekMap.markersAssoc[a]&&(b.fn.TekMap.markersAssoc[a].setMap(null),delete b.fn.TekMap.markersAssoc[a])};b.fn.TekMap.markers=[];b.fn.TekMap.defaults={lat:42,lng:3,click:b.noop,mapoptions:{zoom:12,mapTypeId:c.maps.MapTypeId.ROADMAP,scrollwheel:!1},markers:[]};b.fn.TekMarker.defaults={draggable:!1,infowindowclosePrevious:!0}})(jQuery,google,window);