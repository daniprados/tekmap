(function(b,c,j){function m(a,e){var d,g,f,h={position:new c.maps.LatLng(a.lat,a.lng),map:e,draggable:a.draggable},i,k,j;a.icon&&("object"===typeof a.icon?(g=new c.maps.Size(a.icon.size[0],a.icon.size[0]),d=a.icon.base?new c.maps.Point(a.icon.base[0],a.icon.base[1]):new c.maps.Point(0,0),f=new c.maps.Point(a.icon.origin[0],a.icon.origin[1]),d=new c.maps.MarkerImage(a.icon.url,g,d,f),b.extend(h,h,{icon:d})):b.extend(h,h,{icon:a.icon}));a.shadow&&("object"===typeof a.shadow?(g=new c.maps.Size(a.shadow.size[0], a.shadow.size[0]),d=a.shadow.base?new c.maps.Point(a.shadow.base[0],a.shadow.base[1]):new c.maps.Point(0,0),f=new c.maps.Point(a.shadow.origin[0],a.shadow.origin[1]),d=new c.maps.MarkerImage(a.shadow.url,g,d,f),b.extend(h,h,{shadow:d})):b.extend(h,h,{shadow:a.shadow}));i=new c.maps.Marker(h);a.key&&(b.extend(i,{tekkey:a.key}),b.fn.TekMap.markersAssoc[a.key]=i);b.fn.TekMap.markers.push(i);a.infowindow&&(k=new c.maps.InfoWindow({content:a.infowindow}),c.maps.event.addListener(i,"click",function(){k.open(e, i);a.infowindowclosePrevious&&(l&&l!==k&&l.close(),l=k)}));j=a.drag||b.noop;a.draggable&&c.maps.event.addListener(i,"dragend",function(){j(i)})}function n(a,e){var d=b.fn.TekMap.opts,g=d.mapoptions,f,h=b(e);f=new c.maps.LatLng(d.lat,d.lng);g.center=f;g=new c.maps.Map(e,g);d.click&&c.maps.event.addListener(g,"click",d.click);for(f=0;f<d.markers.length;f+=1)m(d.markers[f],g);h.data("tekmap",g)}var l=null;b.fn.TekMap=function(a){j.console&&j.console.log&&j.console.log("tekmap initialized"+this);b.fn.TekMap.opts= b.extend({},b.fn.TekMap.defaults,a);b.fn.TekMap.markers=[];b.fn.TekMap.markersAssoc={};return this.each(n)};b.fn.TekMarker=function(a){var e,d=this;b.fn.TekMap.p=b.extend({},b.fn.TekMarker.defaults,a);return a.addres?(e=new c.maps.Geocoder,e.geocode({address:a.addres},function(a,e){e===c.maps.GeocoderStatus.OK&&b.each(a,function(a,c){b.fn.TekMap.p.lat=c.geometry.location.lat();b.fn.TekMap.p.lng=c.geometry.location.lng();d.each(b.fn.TekMarker.marker)})}),this):this.each(b.fn.TekMarker.marker)};b.fn.TekMarker.marker= function(){var a=b.fn.TekMap.p,c=b.fn.TekMap.map;c||(c=b(this).data("tekmap"));m(a,c)};b.fn.TekMarker.trigger=function(a,e,d){b.fn.TekMap.markersAssoc[a]&&(c.maps.event.trigger(b.fn.TekMap.markersAssoc[a],e),"function"===typeof d&&d(b.fn.TekMap.markersAssoc[a]))};b.fn.TekMarker.remove=function(a){b.fn.TekMap.markersAssoc[a]&&(b.fn.TekMap.markersAssoc[a].setMap(null),delete b.fn.TekMap.markersAssoc[a])};b.fn.TekMap.markers=[];b.fn.TekMap.defaults={lat:42,lng:3,click:b.noop,mapoptions:{zoom:12,mapTypeId:c.maps.MapTypeId.ROADMAP, scrollwheel:!1},markers:[]};b.fn.TekMarker.defaults={draggable:!1,infowindowclosePrevious:!0}})(jQuery,google,window);